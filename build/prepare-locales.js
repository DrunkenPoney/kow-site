const { readdirSync, writeFileSync } = require('fs')
const { resolve, basename } = require('path')

const LOCALES_DIR = resolve(__dirname, '../src/locales')
const LANGUAGES_FILE_PATH = resolve(LOCALES_DIR, 'languages.js')

let languages = {}
for (let dirent of readdirSync(LOCALES_DIR, { withFileTypes: true })) {
  if (dirent.isFile() && /^[a-z]{2}\.json$/.test(dirent.name)) {
    let { language } = require(resolve(LOCALES_DIR, dirent.name))
    if (language == null)
      throw new Error(`property "language" missing in "${dirent.name}"`)
    
    languages[basename(dirent.name, '.json')] = language
  }
}

writeFileSync(LANGUAGES_FILE_PATH,
  `// ===== GENERATED FILE =====` +
  `// DO NOT EDIT THIS FILE!\n` +
  `export default ${JSON.stringify(languages, null, '  ')}`, {
    encoding: 'utf8',
    flag: 'w'
  })